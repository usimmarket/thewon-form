<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>THE ONE 신청서</title>
<style>
  :root{ --bg:#0c1522; --card:#ffffff; --ink:#0f172a; --muted:#6b7280; --accent:#06b6d4; --danger:#ef4444; --line:#e5e7eb; }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.6 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",Arial,sans-serif}

  header{position:sticky;top:0;z-index:5;background:rgba(12,21,34,.9);backdrop-filter:blur(6px);color:#fff;border-bottom:1px solid rgba(255,255,255,.06)}
  .wrap{max-width:1100px;margin:0 auto;padding:12px 16px}
  .top{display:grid;grid-template-columns:240px 1fr 240px;align-items:center;gap:10px}
  .brand-left img{height:46px;display:block}
  .centered{display:flex;justify-content:center;gap:10px;align-items:center}
  .centered img.logo{height:40px;display:block}
  .title{font-weight:800;font-size:18px;letter-spacing:.2px}
  .badge{font-size:12px;border:1px solid rgba(255,255,255,.35);padding:3px 8px;border-radius:10px;margin-left:6px;color:#cbd5e1}
  .chips{margin-left:auto;display:flex;gap:8px;justify-self:end}
  .chip{color:#cbd5e1;border:1px solid #334155;background:transparent;border-radius:14px;padding:4px 10px;cursor:pointer}
  .chip.active{background:#94a3b8;color:#0f172a;border-color:#94a3b8}

  main .wrap{padding:20px 16px 120px}
  h3{margin:0 0 10px 0}
  .card{background:var(--card);border-radius:10px;box-shadow:0 2px 0 rgba(15,23,42,.02),0 0 0 1px #f1f5f9;padding:16px 16px;margin:0 0 16px 0}
  label{display:block;font-size:12px;color:#374151;margin:2px 0 6px}
  .req::after{content:""} /* remove star */
  input[type=text], input[type=email], select, textarea{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:8px;outline:0;background:#fff}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:14px; align-items:start}
  .seg{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .seg .radio{display:inline-flex;align-items:center;gap:6px}
  .muted{color:#6b7280;font-size:12px;margin-top:6px}
  .err{font-size:12px;color:#ef4444;margin-top:6px;display:none}
  .err.show{display:block}
  .invalid{border-color:#ef4444}

  /* 접근성: 포커스 표시 + 스크린리더 유틸 */
  :focus-visible{outline:3px solid var(--accent);outline-offset:2px}
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

  @media (max-width:820px){
    .top{grid-template-columns:160px 1fr 120px}
    .chips{justify-self:center}
    .centered{order:-1}
    .row{grid-template-columns:1fr}
  }

  .fixbar{position:fixed; left:0; right:0; bottom:0; z-index:10; background:rgba(12,21,34,.98); backdrop-filter:blur(6px); border-top:1px solid rgba(255,255,255,.06)}
  .fixbar .wrap{display:flex;gap:10px;justify-content:flex-end;padding:12px 16px}
  .btn{border:1px solid #0ea5b7;background:#0ea5b7;color:#fff;border-radius:10px;padding:10px 14px;cursor:pointer}
  .btn.outline{background:transparent;color:#e2e8f0;border-color:#475569}

  @media print{
    header,.fixbar{display:none !important}
    main .wrap{padding:0}
    .card{box-shadow:none;border:none;padding:0;margin:0}
  }
</style>
</head>
<body>
<header>
  <div class="wrap top">
    <!-- 왼쪽 브랜드: 필요시 기존 base64 이미지를 그대로 유지하세요 -->
    <div class="brand-left">
      <img src="data:image/png;base64,<!-- 기존 base64 이미지 그대로 두세요 -->" alt="Brand">
    </div>

    <!-- 가운데 로고/타이틀 -->
    <div class="centered">
      <img class="logo" src="data:image/png;base64,<!-- 기존 base64 또는 로고 이미지 -->" alt="">
      <div class="title">THE ONE 신청서 <span class="badge">v1</span></div>
    </div>

    <!-- 우측 칩(선택사항) -->
    <div class="chips" aria-label="태그">
      <button type="button" class="chip">안내</button>
      <button type="button" class="chip">문의</button>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <a href="#app-form" class="sr-only">본문으로 건너뛰기</a>

    <form id="app-form" novalidate>
      <!-- 기본 정보 -->
      <div class="card">
        <h3 class="title">기본 정보</h3>
        <div class="row">
          <div>
            <label for="applicant_name" class="req">이름</label>
            <input id="applicant_name" name="applicant_name" type="text" required autocomplete="name" aria-describedby="err_applicant_name">
            <p id="err_applicant_name" class="err" role="alert">이름을 입력해 주세요.</p>
          </div>

          <div>
            <label for="department" class="req">부서</label>
            <select id="department" name="department" required aria-describedby="err_department">
              <option value="">선택하세요</option>
              <option value="sales">영업</option>
              <option value="marketing">마케팅</option>
              <option value="dev">개발</option>
              <option value="design">디자인</option>
            </select>
            <p id="err_department" class="err" role="alert">부서를 선택해 주세요.</p>
          </div>
        </div>

        <div class="seg" role="group" aria-labelledby="apply_type_label">
          <span id="apply_type_label" class="sr-only">신청 유형</span>
          <label class="radio"><input type="radio" name="apply_type" value="personal" required> 개인</label>
          <label class="radio"><input type="radio" name="apply_type" value="team" required> 팀</label>
        </div>
        <p id="err_apply_type" class="err" role="alert">신청 유형을 선택해 주세요.</p>
        <p class="muted">※ ‘팀’ 선택 시 팀 정보 입력란이 나타납니다.</p>
      </div>

      <!-- (토글) 팀 정보: apply_type=team 일 때만 보임 -->
      <div class="card" data-when="apply_type=team" aria-live="polite" aria-hidden="true" hidden>
        <h3 class="title">팀 정보</h3>
        <div class="row">
          <div>
            <label for="team_name" class="req">팀명</label>
            <input id="team_name" name="team_name" type="text" required aria-describedby="err_team_name">
            <p id="err_team_name" class="err" role="alert">팀명을 입력해 주세요.</p>
          </div>
          <div>
            <label for="team_size" class="req">팀 인원</label>
            <select id="team_size" name="team_size" required aria-describedby="err_team_size">
              <option value="">선택하세요</option>
              <option value="2-3">2–3명</option>
              <option value="4-5">4–5명</option>
              <option value="6+">6명 이상</option>
            </select>
            <p id="err_team_size" class="err" role="alert">팀 인원을 선택해 주세요.</p>
          </div>
        </div>
      </div>

      <!-- 연락처 -->
      <div class="card">
        <h3 class="title">연락처</h3>
        <div class="row">
          <div>
            <label for="email" class="req">이메일</label>
            <input id="email" name="email" type="email" required autocomplete="email" aria-describedby="err_email">
            <p id="err_email" class="err" role="alert">올바른 이메일을 입력해 주세요.</p>
          </div>
          <div>
            <label for="phone">연락처 (선택)</label>
            <input id="phone" name="phone" type="text" inputmode="tel" placeholder="010-1234-5678">
          </div>
        </div>
      </div>

      <!-- 고정 하단 버튼 -->
      <div class="fixbar">
        <div class="wrap">
          <button type="button" class="btn outline" id="btn-print">인쇄</button>
          <button type="submit" class="btn" id="btn-submit">제출하기</button>
        </div>
      </div>
    </form>
  </div>
</main>

<!-- ✅ 스크립트는 </body> 바로 위에 두세요 -->
<script>
(() => {
  const form = document.getElementById('app-form');
  const submitBtn = document.getElementById('btn-submit');
  const printBtn  = document.getElementById('btn-print');

  const $  = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

  /* -----------------------------
   * 1) 데이터 속성 토글(data-when)
   *    - 형식: data-when="필드명=값1|값2"
   *    - 라디오/셀렉트/텍스트 모두 지원(텍스트는 정확히 일치할 때)
   * ---------------------------*/
  const getFieldValue = (name) => {
    const field = form.elements[name];
    if (!field) return '';
    if (field instanceof RadioNodeList) {
      const checked = Array.from(field).find(i => i.checked);
      return checked ? checked.value : '';
    }
    return field.value ?? '';
  };

  const matchWhen = (expr) => {
    // "field=value1|value2" 형태
    const [field, valuesRaw] = expr.split('=');
    if (!field) return false;
    const actual = getFieldValue(field.trim());
    if (valuesRaw === undefined) return !!actual; // 값 생략 시: 값 유무로 판단
    const wanted = valuesRaw.split('|').map(s => s.trim());
    return wanted.includes(actual);
  };

  const updateToggles = () => {
    $$('[data-when]', form).forEach(section => {
      const cond = section.getAttribute('data-when') || '';
      const andParts = cond.split('&').map(s => s.trim()).filter(Boolean); // "a=b & c=d" 지원
      const show = andParts.every(matchWhen);
      section.hidden = !show;
      section.setAttribute('aria-hidden', String(!show));
      // 섹션이 숨겨지면 내부 필수값 일시 해제(검증 방지)
      $$('[required]', section).forEach(el => el.toggleAttribute('data-was-required', show ? false : el.hasAttribute('required')));
      $$('[required]', section).forEach(el => { if (!show) el.removeAttribute('required'); });
      if (show) $$('[data-was-required]', section).forEach(el => { el.setAttribute('required', ''); el.removeAttribute('data-was-required'); });
    });
  };

  // 입력 변경 시 토글 갱신
  form.addEventListener('input', updateToggles);
  form.addEventListener('change', updateToggles);
  document.addEventListener('DOMContentLoaded', updateToggles);
  updateToggles();

  /* -----------------------------
   * 2) 간단 폼 검증(필수/이메일/라디오)
   * ---------------------------*/
  const showErr = (input, id) => { input.classList.add('invalid'); const e = document.getElementById(id); if (e) e.classList.add('show'); };
  const hideErr = (input, id) => { input.classList.remove('invalid'); const e = document.getElementById(id); if (e) e.classList.remove('show'); };

  const validateField = (el) => {
    const errId = el.getAttribute('aria-describedby');
    if (el.type === 'radio') {
      const name = el.name;
      const group = $$(`input[type=radio][name="${name}"]`, form);
      const checked = group.some(r => r.checked);
      group.forEach(r => checked ? hideErr(r, 'err_' + name) : showErr(r, 'err_' + name));
      return checked;
    }
    if (el.required && !el.value.trim()) { showErr(el, errId); return false; }
    if (el.type === 'email' && el.value) {
      const ok = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(el.value);
      if (!ok) { showErr(el, errId); return false; }
    }
    hideErr(el, errId);
    return true;
  };

  const validateAll = () => {
    const requiredEls = $$('[required]', form);
    let firstBad = null, ok = true;
    const seenRadio = new Set();
    for (const el of requiredEls) {
      if (el.type === 'radio') { if (seenRadio.has(el.name)) continue; seenRadio.add(el.name); }
      const good = validateField(el);
      if (!good && !firstBad) firstBad = el, ok = false;
    }
    if (!ok && firstBad) {
      firstBad.focus({preventScroll:true});
      firstBad.scrollIntoView({behavior:'smooth', block:'center'});
    }
    return ok;
  };

  form.addEventListener('input', (e) => {
    const t = e.target;
    if (t.matches('[required]')) validateField(t);
  });

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!validateAll()) return;

    // 중복 제출 방지
    const original = submitBtn.textContent;
    submitBtn.disabled = true; submitBtn.textContent = '제출 중…';

    try {
      // 실제 서버 연동 시 아래 fetch 로 교체
      // const fd = new FormData(form);
      // await fetch('/submit', { method:'POST', body: fd });

      // 데모용
      await new Promise(r => setTimeout(r, 600));
      alert('제출이 완료되었습니다!');
      // form.reset(); // 필요하면 초기화
    } catch (err) {
      alert('제출 중 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.');
    } finally {
      submitBtn.disabled = false; submitBtn.textContent = original;
    }
  });

  // 인쇄
  printBtn?.addEventListener('click', () => window.print());
})();
</script>
</body>
</html>
